cmake_minimum_required(VERSION 2.8.3)
project(openpose)

set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${PROJECT_SOURCE_DIR}/cmake/Modules/")
message(STATUS "CMAKE Module Path at ${CMAKE_MODULE_PATH}")

add_definitions(-std=c++11)
add_definitions(-DUSE_CAFFE)

find_package(catkin REQUIRED COMPONENTS
	roscpp
	rospy
	std_msgs
	sensor_msgs
	geometry_msgs
	visualization_msgs
	#justina_tools
	takeshi_tools
	cmake_modules
	tf
	tf_conversions
	vision_msgs
	)

find_package(Eigen3 REQUIRED)

## System dependencies are found with CMake's conventions
# find_package(Boost REQUIRED COMPONENTS system)

set(OPENPOSE_DIR "$ENV{OPENPOSE_HOME}")

if(OPENPOSE_DIR)               # <--- Use 'BOOST_DIR', not 'DEFINED ${BOOST_DIR}'
find_package(GFlags)
find_package(TinyXML REQUIRED)
find_package(Glog)
find_package(OpenPose REQUIRED)
find_package(OpenCV)
find_package(Eigen3 REQUIRED)            # <--- Use 'BOOST_DIR', not 'DEFINED ${BOOST_DIR}'
find_package(CUDA REQUIRED)
find_package(gflags REQUIRED)
message(STATUS "OPENPOSE_HOME at ${OPENPOSE_DIR}")
	## Generate messages in the 'msg' folder
	# add_message_files(
	#   FILES
	#   Message1.msg
	#   Message2.msg
	# )

	## Generate services in the 'srv' folder
	# add_service_files(
	#   FILES
	#   Service1.srv
	#   Service2.srv
	# )

	## Generate added messages and services with any dependencies listed here
	# generate_messages(
	#   DEPENDENCIES
	#   std_msgs
	# )

	catkin_package(
		#  INCLUDE_DIRS include
		#  LIBRARIES openpose
		#  CATKIN_DEPENDS roscpp rospy std_msgs
		#  DEPENDS system_lib
		# DEPENDS Eigen3
		INCLUDE_DIRS
      		include
    	DEPENDS
      		TinyXML
		)

	include_directories(
		include
		${TinyXML_INCLUDE_DIRS}
		${catkin_INCLUDE_DIRS}
		${CUDA_INCLUDE_DIRS}
		${Eigen_INCLUDE_DIRS}
		${OpenPose_INCLUDE_DIRS}
		${GFLAGS_INCLUDE_DIR}
		${GLOG_INCLUDE_DIR}
		${OpenCV_INCLUDE_DIRS}
		)

	add_library(OpenPose src/OpenPose.cpp)
	target_link_libraries(OpenPose
		${catkin_LIBRARIES}
		${Eigen_LIBRARIES}
		${OpenPose_LIBS}
		${GFLAGS_LIBRARY}
		${GLOG_LIBRARY}
		${OpenCV_LIBS}
		gflags
		)

	add_executable(open_pose_node src/open_pose_node.cpp)
	target_link_libraries(open_pose_node ${TinyXML_LIBRARIES} ${catkin_LIBRARIES} OpenPose)
else()
	message(WARNING "Undefined OPENPOSE_HOME env var, this package will not be compiled.")
endif()
